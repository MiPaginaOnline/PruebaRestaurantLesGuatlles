import type { Medication, MedicationLog } from "@shared/schema";
import { Card } from "@/components/ui/card";
import { getTodayScheduledTimes } from "@/lib/date-utils";

interface StatsGridProps {
medications: Medication[];
logs: MedicationLog[];
}

export default function StatsGrid({ medications, logs }: StatsGridProps) {
const activeMedications = medications.filter(m => m.isActive);

// Calculate stats
let totalDueToday = 0;
activeMedications.forEach(med => {
totalDueToday += (med.times as string[]).length;
});

const takenToday = logs.filter(log => log.status === "taken").length;
const missedToday = logs.filter(log => log.status === "missed").length;
const upcomingToday = totalDueToday - takenToday - missedToday;

const stats = [
{
title: "Medications Due",
value: totalDueToday,
icon: (
<svg className="w-6 h-6 text-primary" fill="currentColor" viewBox="0 0 20 20">
<path d="M10 2a6 6 0 00-6 6v3.586l-.707.707A1 1 0 004 14h12a1 1 0 00.707-1.707L16 11.586V8a6 6 0 00-6-6zM10 18a3 3 0 01-3-3h6a3 3 0 01-3 3z" />
</svg>
),
bgColor: "bg-primary/10",
badge: "Today",
badgeColor: "bg-success/10 text-success"
},
{
title: "Taken Today",
value: takenToday,
icon: (
<svg className="w-6 h-6 text-success" fill="currentColor" viewBox="0 0 20 20">
<path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clipRule="evenodd" />
</svg>
),
bgColor: "bg-success/10"
},
{
title: "Upcoming",
value: upcomingToday,
icon: (
<svg className="w-6 h-6 text-accent" fill="currentColor" viewBox="0 0 20 20">
<path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clipRule="evenodd" />
</svg>
),
bgColor: "bg-accent/10"
},
{
title: "Missed",
value: missedToday,
icon: (
<svg className="w-6 h-6 text-destructive" fill="currentColor" viewBox="0 0 20 20">
<path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clipRule="evenodd" />
</svg>
),
bgColor: "bg-destructive/10"
}
];

return (
<div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 md:gap-6">
{stats.map((stat, index) => (
<Card key={index} className="p-6" data-testid={`stat-card-${index}`}>
<div className="flex items-center justify-between mb-3">
<div className={`w-12 h-12 ${stat.bgColor} rounded-lg flex items-center justify-center`}>
{stat.icon}
</div>
{stat.badge && (
<span className={`text-xs font-medium px-2 py-1 rounded-full ${stat.badgeColor}`}>
{stat.badge}
</span>
)}
</div>
<p className="text-muted-foreground text-sm mb-1">{stat.title}</p>
<p className="text-3xl font-bold text-foreground" data-testid={`stat-value-${index}`}>
{stat.value}
</p>
</Card>
))}
</div>
);
}
